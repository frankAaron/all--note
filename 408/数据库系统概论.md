[TOC]

------

# 初步认识数据库

## 什么是数据库

### 数据库与信息管理

数据库是电子化信息的集合，方便使用计算机对这些信息进行快速的储存搜索

### 数据库与表

数据库关系密切

### 表

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E8%A1%A8.png)

表与表之间也有关系，一对一，一对多

## 什么是数据库系统

### 数据库系统

-   数据库（DB）
-   数据库管理系统（DBMS）
-   数据库应用（DBAP）
-   数据库管理员（DBA）
-   计算机基本系统

### 数据库系统的功能

用户

-   数据库的定义  
    -   DBMS 解析DDL
-   数据库的操作
    -   DML
-   数据库控制
    -   DBMS 解析DCL
-   数据库维护
    -   DBA管理维护

系统

形式-> 构造-> 自动化

### 数据库语言

sql语句

DDL  定义语言

DML 操作  增删改查

DCL  控制数据

DBMS进行解析

数据库语言可以嵌入高级语言（宿主语言）中使用

## 数据库系统的标准结构

### 数据库的分层抽象

DBMS管理数据的三个层次

-   局部层次
    -   用户能看到与处理的数据
-   全局层次   概念层次
    -   全局管理数据
-   内部层次   --->数据库
    -   介质上的数据，含路径，存储方式，索引方式

模式       数据的结构

视图/数据   模式的一种展现方式（表，图，树）

### 三种模式

外模式       用户看到处理的数据（外部视图）的结构描述

概念模式    全局角度管理的数据的结构描述

内模式        介质上的数据的结构描述

### 两层映像

E-C映像   外模式映像为概念模式

C-I映像	概念模式映像为内模式

### 两个独立性

逻辑数据独立性	概念模式变化可以不改变外部模式

物理数据独立性	内模式变化可以不改变概念模式

理解：

逻辑数据独立性   概念模式即全局模式，外部模式是全局模式的一个子集，改变全集不一定要该百年这个子集

物理数据独立性   内部模式即数据存储的介质，改变数据后需要通过C-I映像才能变成概念模式，可以改变C-I映像来使得概念模式不变

## 数据模型

数据模型   模式的结构    模式是数据的结构   ——>数据模型即数据的结构的结构

理解： 数据模型是多个模式（表）的操作/关系

### 三大数据模型

关系模型：表

层次模型：树

网状模型：图

### 数据库系统的演变发展

### 文件系统到数据库

文件系统需要读写比较繁琐

数据库可以通过数据库管理系统提供的数据库语言来找到数据

### 层次模型数据库、网状模型数据库到关系数据库

层次与网状	通过指针建立联系	需要用户建立

关系	通过table的属性来建立联系

### 关系数据库到对象关系数据库、面向对象数据库

关系数据库

-   按行按列形式组织数据
-   数据项不可再分
-   设计理论

对象关系数据库可以支持不满足第一范式的数据项：一个数据一个属性，不能一个数据多个属性

### 多种多样的数据库到多数据库开放式互连

### 小结

三个模式两层映像两个独立性

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/1.2%E5%B0%8F%E7%BB%93.png)

# 第二章关系数据库																																									

## 2.1关系数据结构及形式化定义

### 2.1.1关系

单一的数据结构----关系

逻辑结构---二维表

1.域	相同数据类型的值的集合

2.笛卡尔积  从每个域中抽取元素进行组合

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E4%BE%8B%E5%AD%90.png)

分量   每个元组/记录中的一个数据

基数
$$
M=\pi\
$$

#### 码

一个属性组（某一列），能确定唯一一个记录

##### 候选码

符合条件

##### 全码

所有的属性都知道才能确定一个记录即为全码

##### 主码

关系有多个候选码，选一个为主码，

##### 主属性

候选码的属性成为主属性，其他为非主属性

##### 非主属性

#### 三类关系

##### 基本关系

实际存在的表

##### 查询表

查询结果对应的表

##### 视图表

由基本表或其他视图导出的表

#### 基本关系的性质

-   列是同质的
-   不同的列可以出自同一个域，不同的列不出现相同的属性名
-   列的顺序可以交换
-   任意两个元组的候选码不能相同
-   行的舒徐可以改变
-   分量必须取原子值

#### 2.1.2关系模式

对关系的描述

##### 1、什么是关系模式

###### 元组集合的结构

属性结构、属性来自的域、属性与域之间的映像关系

###### 一个关系由元组确定

###### 完整性的约束

##### 2、定义关系模式

关系模式可以形式化表示为R(U,D,DOM,F)

R:关系名

U：组成该关系的属性名集合

D：属性组U中属性所来自的域

DOM：属性向域的映像集合

F:属性见的数据依赖关系集合

##### 3、关系模式与关系

模式是静态的，关系是动态的

模式是模具，关系是产品

#### 2.1.3关系数据库

所有关系的集合

##### 关系数据库的型与值

关系数据库的型：关系数据库模式，对关系数据库的描述

关系数据库模式：域上的关系模式，（）

关系数据库的值：放了哪些数据

#### 2.1.4关系模型的存储结构

两种存储方式

1、数据库管理系统，数据库管理系统开辟空间

## 2.2关系数据结构

常用的关系操作

查询：选择、投影、连接、除并、交、差等

#### 关系操作的特点

不改变本身性质

##### 关系演算语言

元组关系演算语言：APLHA，QUEL

域关系演算：QBF

SQL语句

## 2.3关系的完整性

三类完整性约束:实体完整性，参照完整性，用户定义的完整性

实体完整性，参照完整性是关系模型必须满足的完整性

### 实体完整性

属性A是基本关系R的主属性，则A不能为空。即没有两个完全相同的东西，他的编号，日期等都不一样，这些用来区分两个实体的值即为主属性

#### 规则说明

1.  是针对基本关系而言
2.  是区分的
3.  主码作为唯一标识

#### 参照完整性

**关系间的引用** 一张表引用另一张表，其数据必须来自于另一张表

##### 外码

F如果是R的一个或一组属性，但不是关系R的码。如果F与关系S的主码K相对应，则成F是基本关系R的外码

##### 规则

托属性F是基本关系的外码，他与基本关系s的主码相对应，则R中每个元组在F上的值必须为 空值（F的每个属性均为空值），等于s中某个元素的主码值

### 用户定义完整性

用户设置的属性取值，符合现实

## 2.4关系代数

两个表进行运算

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97.png)

### 并

把两个具有相同属性且取自同一个域的表

![并运算](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E5%B9%B6%E8%BF%90%E7%AE%97.png)

### 差

抛去相同的

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E5%B7%AE%E8%BF%90%E7%AE%97.png)

### 交

取s中又在s中的

### 笛卡尔积

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E8%BF%90%E7%AE%97.png)

## 2.4.2专门的关系运算

选择、投影、连接、除运算

#### 象集

即因变量

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E8%B1%A1%E9%9B%86.png)

![条件运算符](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%AD%E7%9A%84%E8%BF%90%E7%AE%97%E7%AC%A6.png)

#### 连接

##### 一般连接

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E4%B8%80%E8%88%AC%E9%93%BE%E6%8E%A5%E7%9A%84%E4%BE%8B%E5%AD%90.png)

##### 等值连接

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5%E4%BE%8B%E5%AD%90.png)

##### 自然连接

必须由相同的属性名，并且可以比较

#### 悬浮元组

被舍弃的元组

##### 外连接

悬浮元组加到连接表中无对应的东西写空值

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E5%A4%96%E8%BF%9E%E6%8E%A5.png)

##### 左外连接

只加左边的加到表中

##### 右外连接

只加右边的加到表中

### 除

可以有不同的属性名，但不惜出自相同的域集（结果是减法，及属性比之前的少）

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E9%99%A4%E8%BF%90%E7%AE%97.png)

步骤

1.  先找到相同属性（Y）
2.  取第一个关系（R）中的一个属性找到它的所有象集Z
3.  看Z中包含所有 第二个关系（S）中相同的属性（Y）
4.  即为R÷S


$$
\begin{flalign}
&选择：\sigma ->选出一行  \\
&投影：\pi  ->向下投影  \\
&连接：  \Join  ->笛卡尔积R\times S选出R关系上的S并且满足\theta关系\\
&除：÷
\end{flalign}
$$

## 2.5关系演算

b站 2.7

# 第三章sql语句

## 3.1  sql概述

**sql**：结构化查询语言

### 3.1.2  sql特点

1.  综合统一

    1.  ddl，dml，dcl

    2.  独立完成数据库声明周期中的全部活动：

        定义关系模式，插入数据，建立数据库；对数据库中的数据进行查询和更新；数据库重构和维护；

    3.  数据库投入运行后，可以随时修改，不影响数据运行

    4.  数据操作符统一

2.  高度非过程化

    1.  非关系数据模型的数据操作语言“面向过程”，必须指定存储路径
    2.  sql只需要提出做什么

3.  面向集合的操作方式

    1.  

### 3.1.3 sql基本概念

基本表

-   本身独立存在的表
-   sql中一个关系对应一个基本表
-   一个或多个基本表对应一个存储文件
-   一个表可以带若干个索引

存储文件

-   逻辑结构组成了关系数据库的内模式
-   物理结构是任意的，对用户透明

视图

-   从一个或几个基本表导出的表
-   数据库中只存放视图的定义而不存放视图对应的数据
-   视图是一个虚表
-   用户可以在视图上再定义视图

## 3.2学生-课程数据库

学生-课程模式S-T

学生表

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E5%AD%A6%E7%94%9F%E8%A1%A8.png)

课程表

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E8%AF%BE%E7%A8%8B%E8%A1%A8.png)

学生选课表

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E5%AD%A6%E7%94%9F%E9%80%89%E8%AF%BE%E8%A1%A8.png)

## 3.3数据定义

sql的数据定义功能：模式定义、表定义、视图、索引的定义

### 3.3.1模式的定义与删除

模式相当于一个特殊功能的房间

#### 1. 定义模式

```
      CREATE SCHEMA "S-T" AUTHORIZATION BitHachi;
      为用户BitHachi定义了一个模式S-T
```

      CREATE SCHEMA AUTHORIZATION BitHachi；
      <模式名>隐含为用户名BitHachi
      这个不知道咋回事，没出结果，默认模式BitHachi没创建出来，没显示

#### 2. 删除模式

```
DROP SCHEMA "S-T" <CASCADE | RESTRICT>;
```

-   CASCADE 或者RESTRICT必须二选一
-   CASCADE（级联）删除模式和苏哟有数据库对象
-   RESTRICT（限制）如果有数据库则不能执行

### 3.3.2基本表的定义、删除与修改

#### 1.定义基本表

```
CREATE TABLE <表名>(
      <列名> <数据类型>[ <列级完整性约束条件> ]
      [，<列名> <数据类型>[ <列级完整性约束条件>] ]
       ………
      [，<表级完整性约束条件> ]
 );
```

```
CREATE TABLE Course
(Cno CHAR(4) PRIMARY KEY,
Cpno CHAR(4),
FOREIGN KEY(Cpno) REFERENCES Course(Cno))   外键 Cpno 参照Cno
```

1.  建立表的时候写上模式名
    1.  CREATE TABLE "S-T" .Student ()
2.  见模式的时候把表放进去
3.  设置默认值

#### 2.数据类型

![](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png)

#### 3.模式与表

```
SHOW search_path; //显示当前的搜索路径
$user, PUBLIC; //搜索路径的当前默认值
SET search_path T0 "S-T",PUBLIC //DBA用户可以设置搜索路径
```



#### 4.修改基本表

```
ALTER TABLE <表明>
[ADD [COLUMN] <新列明> <数据类型> [完整性约束]]   修改现有的列
[ADD <表级完整性约束>]
[DROP [COLUMN] <列名> []]
[DROP CONSTRAINT <完整性约束>]
[ALTER COLUMN <列明> <数据类型>]
```

5.删除基本表

```
DROP TABLE <表名> [RESTRICT | CASCADE]
```

在这个表定义的视图都会被删掉

### 3.3.3索引的建立与删除

建立索引目的：加快查询速度

可以建立索引：DBA，DBMS一般会自动加你索引：primary key unique

维护索引：DBMS自动完成

使用索引：DBMS自动选择是否使用索引

-   RDBMS中一般采用B+树、hash索引来实现
-   索引是关系数据库内部实现技术，属于内模式
-   索引分为三类：唯一索引，非唯一索引或聚簇索引

#### 1.建立索引

```
create [unique] [cluster] index <索引名> on <biao'min>
```

